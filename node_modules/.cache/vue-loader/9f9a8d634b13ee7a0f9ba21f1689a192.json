{"remainingRequest":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ebubeker/Desktop/programming/work tasks/goat/app/client/src/components/heatmaps/Heatmaps.vue?vue&type=style&index=0&id=c4830462&lang=css&scoped=true&","dependencies":[{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/src/components/heatmaps/Heatmaps.vue","mtime":1657636289855},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/css-loader/index.js","mtime":1657636580953},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1657636583241},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/postcss-loader/src/index.js","mtime":1657636582109},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/vuetify-loader/lib/loader.js","mtime":1657636582513},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/cache-loader/dist/cjs.js","mtime":1657636581841},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/vue-loader/lib/index.js","mtime":1657636582549}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.v-expansion-panel__header {\n  cursor: default;\n}\n.active-icon {\n  color: #30c2ff;\n}\n\n.expansion-panel__container--active {\n  background-color: white !important;\n}\n\n.checkbox >>> .v-input__control {\n  height: 25px;\n}\n\n.v-expansion-panel-content >>> .v-expansion-panel-content__wrap {\n  padding: 0px;\n}\n\n.v-expansion-panel-content >>> .v-input__slot {\n  margin-bottom: 0px;\n}\n\n.layer-row >>> .v-expansion-panel-header {\n  cursor: auto;\n}\n",{"version":3,"sources":["Heatmaps.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsaA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"Heatmaps.vue","sourceRoot":"src/components/heatmaps","sourcesContent":["<template>\n  <v-flex xs12 sm8 md4>\n    <vue-scroll>\n      <template>\n        <!-- HEATMAP LAYERS -->\n        <v-expansion-panels accordion multiple v-model=\"heatmapPanel\">\n          <v-expansion-panel\n            v-for=\"(layerGroupValue, layerGroupKey) in heatmapGroup\"\n            :key=\"layerGroupKey\"\n            expand\n          >\n            <v-expansion-panel-header\n              class=\"elevation-2\"\n              expand-icon=\"\"\n              v-slot=\"{ open }\"\n            >\n              <v-layout row wrap align-center>\n                <v-flex xs1>\n                  <img\n                    height=\"20\"\n                    width=\"20\"\n                    class=\"mr-3\"\n                    src=\"img/layer-style-icons/hexagon.svg\"\n                  />\n                </v-flex>\n                <v-flex xs10 class=\"light-text\" style=\"font-size:medium;\">\n                  <div>\n                    <b>{{ translate(\"layerGroup\", layerGroupKey) }}</b>\n                  </div>\n                </v-flex>\n                <v-flex xs1>\n                  <v-icon v-html=\"open ? 'remove' : 'add'\"></v-icon>\n                </v-flex>\n              </v-layout>\n            </v-expansion-panel-header>\n            <v-expansion-panel-content>\n              <!-- LAYERS -->\n              <v-expansion-panels readonly>\n                <v-expansion-panel\n                  v-for=\"(layer, i) in layerGroupValue\"\n                  :key=\"i\"\n                  :disabled=\"isHeatmapDisabled(layer)\"\n                  class=\"layer-row\"\n                  :style=\"{\n                    backgroundColor: isHeatmapDisabled(layer)\n                      ? '#ECECEC'\n                      : '#ffffff'\n                  }\"\n                  :class=\"{\n                    'expansion-panel__container--active':\n                      layer.get('showOptions') === true\n                  }\"\n                >\n                  <v-expansion-panel-header expand-icon=\"\" v-slot=\"{}\">\n                    <v-layout row class=\"pl-1\" wrap align-center>\n                      <v-flex class=\"checkbox\" xs1>\n                        <v-checkbox\n                          :color=\"appColor.secondary\"\n                          :input-value=\"layer.getVisible()\"\n                          @change=\"\n                            toggleLayerVisibility(layer, layerGroupValue)\n                          \"\n                        ></v-checkbox>\n                      </v-flex>\n                      <v-flex xs10 class=\"light-text\">\n                        <h4 class=\"pl-2\">\n                          {{ translate(\"layerName\", layer.get(\"name\")) }}\n                        </h4>\n                      </v-flex>\n                      <v-flex xs1>\n                        <v-icon\n                          v-show=\"layer.getVisible()\"\n                          small\n                          style=\"width: 30px; height: 30px;\"\n                          v-html=\"\n                            layer.get('showOptions')\n                              ? 'fas fa-chevron-down'\n                              : 'fas fa-chevron-up'\n                          \"\n                          :class=\"{\n                            'expansion-panel__container--active': layer.get(\n                              'showOptions'\n                            )\n                          }\"\n                          @click.stop=\"toggleHeatmapOptions(layer)\"\n                        ></v-icon>\n                      </v-flex>\n                    </v-layout>\n                  </v-expansion-panel-header>\n                  <!-- --- -->\n                  <!-- LAYER LEGEND AND SETTINGS  -->\n                  <v-card\n                    class=\"pt-2\"\n                    v-show=\"layer.get('showOptions') === true\"\n                    style=\"background-color: white;\"\n                    transition=\"slide-y-reverse-transition\"\n                  >\n                    <InLegend :layer=\"layer\"></InLegend>\n                    <v-layout row style=\"width:100%;padding-left: 10px;\">\n                      <v-flex\n                        class=\"xs2\"\n                        style=\"text-align:center;\"\n                        v-if=\"\n                          ['VECTORTILE', 'VECTOR', 'MVT', 'GEOBUF'].includes(\n                            layer.get('type').toUpperCase()\n                          )\n                        \"\n                      >\n                        <v-icon\n                          v-ripple\n                          style=\"color:#B0B0B0;margin-top:3px;cursor:pointer\"\n                          dark\n                          @click=\"openStyleDialog(layer)\"\n                        >\n                          fas fa-cog\n                        </v-icon>\n                      </v-flex>\n                      <v-flex\n                        :class=\"{\n                          xs10:\n                            ['VECTORTILE', 'VECTOR', 'MVT', 'GEOBUF'].includes(\n                              layer.get('type').toUpperCase()\n                            ) == true,\n                          xs12: false\n                        }\"\n                      >\n                        <v-slider\n                          :value=\"layer.getOpacity()\"\n                          class=\"mx-5\"\n                          step=\"0.05\"\n                          min=\"0\"\n                          max=\"1\"\n                          @input=\"changeLayerOpacity($event, layer)\"\n                          :label=\"$t('layerTree.settings.transparency')\"\n                          :color=\"appColor.secondary\"\n                        ></v-slider>\n                      </v-flex>\n                    </v-layout>\n                  </v-card>\n                  <!-- --- -->\n                </v-expansion-panel>\n              </v-expansion-panels>\n            </v-expansion-panel-content>\n          </v-expansion-panel>\n        </v-expansion-panels>\n      </template>\n      <v-card-actions v-if=\"unCalculatedDataUploadIds.length > 0\">\n        <v-spacer></v-spacer>\n        <v-btn\n          :loading=\"isRecomputingHeatmap\"\n          class=\"white--text\"\n          @click=\"recomputeHeatmaps\"\n          :color=\"appColor.primary\"\n        >\n          <v-icon left>fas fa-refresh</v-icon\n          >{{ $t(\"heatmaps.recomputeHeatmap\") }}</v-btn\n        >\n      </v-card-actions>\n    </vue-scroll>\n    <span v-if=\"styleDialogStatus\">\n      <StyleDialog\n        :item=\"currentItem\"\n        :translate=\"translate\"\n        :key=\"styleDialogKey\"\n        :styleDialogStatus=\"styleDialogStatus\"\n      ></StyleDialog>\n    </span>\n  </v-flex>\n</template>\n<script>\nimport { mapGetters, mapMutations } from \"vuex\";\nimport { EventBus } from \"../../EventBus\";\nimport { Mapable } from \"../../mixins/Mapable\";\nimport { mapFields } from \"vuex-map-fields\";\nimport Legend from \"../viewer/ol/controls/Legend\";\nimport LayerTree from \"../layers/layerTree/LayerTree\";\nimport StyleDialog from \"../layers/changeStyle/StyleDialog.vue\";\nimport InLegend from \"../viewer/ol/controls/InLegend.vue\";\nimport ApiService from \"../../services/api.service\";\nimport { GET_USER_CUSTOM_DATA } from \"../../store/actions.type\";\n\nexport default {\n  mixins: [Mapable, Legend, LayerTree],\n  components: {\n    InLegend,\n    StyleDialog\n  },\n  data: () => ({\n    heatmapPanel: [0],\n    heatmapGroup: {},\n    interactionType: \"heatmap-interaction\",\n    heatmapsWithPois: [\n      \"heatmap_accessibility_population\",\n      \"heatmap_local_accessibility\"\n    ],\n\n    updateHeatmaps: {\n      poi: [\"heatmap_local_accessibility\", \"heatmap_accessibility_population\"],\n      population: [\"heatmap_accessibility_population\", \"heatmap_population\"]\n    },\n    currentItem: null,\n    styleDialogKey: 0,\n    styleDialogStatus: false\n  }),\n\n  mounted() {\n    EventBus.$on(\"updateStyleDialogStatusForLayerOrder\", value => {\n      this.styleDialogStatus = value;\n    });\n  },\n  computed: {\n    ...mapGetters(\"app\", {\n      appColor: \"appColor\",\n      appConfig: \"appConfig\",\n      calculationMode: \"calculationMode\",\n      unCalculatedDataUploadIds: \"unCalculatedDataUploadIds\"\n    }),\n    ...mapGetters(\"poisaois\", {\n      selectedPoisOnlyKeys: \"selectedPoisOnlyKeys\"\n    }),\n    ...mapGetters(\"scenarios\", {\n      activeScenario: \"activeScenario\"\n    }),\n    ...mapFields(\"map\", {\n      heatmapCancelToken: \"heatmapCancelToken\"\n    }),\n    ...mapFields(\"app\", {\n      isRecomputingHeatmap: \"isRecomputingHeatmap\"\n    })\n  },\n  methods: {\n    ...mapMutations(\"map\", {\n      toggleSnackbar: \"TOGGLE_SNACKBAR\"\n    }),\n    /**\n     * This function is executed, after the map is bound (see mixins/Mapable)\n     * and registers the current map layers.\n     */\n    onMapBound() {\n      this.map\n        .getLayers()\n        .getArray()\n        .forEach(layer => {\n          if (layer.get(\"group\") && layer.get(\"group\") === \"heatmap\") {\n            if (!this.heatmapGroup[layer.get(\"group\")]) {\n              this.heatmapGroup[layer.get(\"group\")] = [];\n            }\n            layer.set(\"attributeDisplayStatusKey\", 0);\n            this.heatmapGroup[layer.get(\"group\")].push(layer);\n          }\n        });\n      EventBus.$on(\"update-heatmap\", updateHeatmapsLinkedTo => {\n        this.refreshHeatmap(updateHeatmapsLinkedTo);\n      });\n    },\n    toggleHeatmapOptions(layer) {\n      layer.set(\"showOptions\", !layer.get(\"showOptions\"));\n    },\n    translate(type, key) {\n      const canTranslate = this.$te(`map.${type}.${key}`);\n      if (canTranslate) {\n        return this.$t(`map.${type}.${key}`);\n      } else {\n        return key;\n      }\n    },\n    openStyleDialog(item) {\n      //This function is used for opening Style Setting dialog component for a layer\n      EventBus.$emit(\"updateStyleDialogStatusForLayerOrder\", false);\n      this.styleDialogStatus = true;\n      if (\n        this.currentItem &&\n        this.currentItem.get(\"name\") !== item.get(\"name\")\n      ) {\n        this.styleDialogKey += 1;\n      }\n      if (\n        this.currentItem &&\n        this.currentItem.get(\"layerTreeKey\") >= 0 &&\n        this.currentItem.get(\"name\") !== item.get(\"name\")\n      ) {\n        this.currentItem.set(\n          \"layerTreeKey\",\n          this.currentItem.get(\"layerTreeKey\") + 1\n        );\n      }\n      this.currentItem = item;\n    },\n    toggleLayerVisibility(layer, group) {\n      if (this.heatmapCancelToken instanceof Function) {\n        this.heatmapCancelToken(\"cancelled\");\n        this.heatmapCancelToken = null;\n      }\n      //Turn off other heatmaps if layer group is heatmap.\n      if (layer.get(\"group\") === \"heatmap\") {\n        group.forEach(lc => {\n          if (lc.get(\"name\") === layer.get(\"name\")) return;\n          lc.setVisible(false);\n          lc.set(\"showOptions\", false);\n        });\n      }\n      layer.setVisible(!layer.getVisible());\n      if (layer.getVisible() === false) {\n        layer.set(\"showOptions\", false);\n      } else {\n        if (this.heatmapCancelToken instanceof Function) {\n          this.heatmapCancelToken(\"cancelled\");\n          this.heatmapCancelToken = null;\n        }\n        layer.getSource().refresh();\n        this.checkIfHeatmapNeedsPois(layer);\n        layer.set(\"showOptions\", true);\n      }\n    },\n    refreshAllVisibleHeatmaps() {\n      this.heatmapGroup[\"heatmap\"].forEach(layer => {\n        if (layer.getVisible()) {\n          this.checkIfHeatmapNeedsPois(layer);\n          if (this.heatmapCancelToken instanceof Function) {\n            this.heatmapCancelToken(\"cancelled\");\n            this.heatmapCancelToken = null;\n          }\n          layer.getSource().refresh();\n        }\n      });\n    },\n    refreshHeatmap(update) {\n      if (this.heatmapCancelToken instanceof Function) {\n        this.heatmapCancelToken(\"cancelled\");\n        this.heatmapCancelToken = null;\n      }\n      if (this.updateHeatmaps[update]) {\n        this.updateHeatmaps[update].forEach(heatmapName => {\n          this.heatmapGroup[\"heatmap\"].forEach(layer => {\n            if (layer.get(\"name\") === heatmapName && layer.getVisible()) {\n              this.checkIfHeatmapNeedsPois(layer);\n              if (this.heatmapCancelToken instanceof Function) {\n                this.heatmapCancelToken(\"cancelled\");\n                this.heatmapCancelToken = null;\n              }\n              layer.getSource().refresh();\n            }\n          });\n        });\n      }\n    },\n    recomputeHeatmaps() {\n      this.isRecomputingHeatmap = true;\n      let queryParam = \"\";\n      this.unCalculatedDataUploadIds.forEach((id, index) => {\n        if (id && index !== this.unCalculatedDataUploadIds.length - 1) {\n          queryParam += `id=${id}&`;\n        } else if (id) {\n          queryParam += `id=${id}`;\n        }\n      });\n      ApiService.get_(`/heatmap/compute/data-upload?${queryParam}`)\n        .then(() => {\n          this.toggleSnackbar({\n            type: this.appColor.primary,\n            message: this.$t(\"heatmaps.heatmapComputedSuccessfully\"),\n            state: true,\n            timeout: 3000\n          });\n        })\n        .catch(() => {\n          this.toggleSnackbar({\n            type: this.appColor.primary,\n            message: this.$t(\"heatmaps.heatmapComputationFailed\"),\n            state: true,\n            timeout: 3000\n          });\n        })\n        .finally(() => {\n          this.$store.dispatch(`app/${GET_USER_CUSTOM_DATA}`);\n          this.isRecomputingHeatmap = false;\n        });\n    },\n    checkIfHeatmapNeedsPois(layer) {\n      this.toggleSnackbar({ state: false });\n      if (\n        this.selectedPoisOnlyKeys.length === 0 &&\n        this.heatmapsWithPois.includes(layer.get(\"name\"))\n      ) {\n        this.toggleSnackbar({\n          type: \"error\",\n          message: this.$t(\"map.snackbarMessages.selectAmenities\"),\n          state: true,\n          timeout: 4000\n        });\n        return true;\n      } else {\n        return false;\n      }\n    },\n    isHeatmapDisabled(layer) {\n      if (\n        this.heatmapsWithPois.includes(layer.get(\"name\")) &&\n        this.unCalculatedDataUploadIds.length > 0\n      ) {\n        layer.setVisible(false);\n        layer.set(\"showOptions\", false);\n        return true;\n      } else {\n        return false;\n      }\n    }\n  },\n  watch: {\n    selectedPoisOnlyKeys() {\n      this.refreshAllVisibleHeatmaps();\n    },\n    activeScenario() {\n      this.refreshAllVisibleHeatmaps();\n    },\n    \"calculationMode.active\": function() {\n      this.refreshAllVisibleHeatmaps();\n    }\n  }\n};\n</script>\n<style lang=\"css\" scoped>\n.v-expansion-panel__header {\n  cursor: default;\n}\n.active-icon {\n  color: #30c2ff;\n}\n\n.expansion-panel__container--active {\n  background-color: white !important;\n}\n\n.checkbox >>> .v-input__control {\n  height: 25px;\n}\n\n.v-expansion-panel-content >>> .v-expansion-panel-content__wrap {\n  padding: 0px;\n}\n\n.v-expansion-panel-content >>> .v-input__slot {\n  margin-bottom: 0px;\n}\n\n.layer-row >>> .v-expansion-panel-header {\n  cursor: auto;\n}\n</style>\n"]}]}