{"remainingRequest":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ebubeker/Desktop/programming/work tasks/goat/app/client/src/components/viewer/ol/controls/Legend.vue?vue&type=style&index=0&id=587abc31&lang=css&scoped=true&","dependencies":[{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/src/components/viewer/ol/controls/Legend.vue","mtime":1657636289859},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/css-loader/index.js","mtime":1657636580953},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1657636583241},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/postcss-loader/src/index.js","mtime":1657636582109},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/vuetify-loader/lib/loader.js","mtime":1657636582513},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/cache-loader/dist/cjs.js","mtime":1657636581841},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/vue-loader/lib/index.js","mtime":1657636582549}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.v-expansion-panel-header {\n  min-height: 30px;\n  padding: 5px;\n}\n\n.v-expansion-panel-content >>> .v-expansion-panel-content__wrap {\n  padding: 2px 0px 0px 5px;\n}\n",{"version":3,"sources":["Legend.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyKA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"Legend.vue","sourceRoot":"src/components/viewer/ol/controls","sourcesContent":["<template>\n  <span></span>\n</template>\n<script>\nimport { mapGetters } from \"vuex\";\nimport { EventBus } from \"../../../../EventBus\";\nimport { Mapable } from \"../../../../mixins/Mapable\";\nimport { getWMSLegendURL } from \"../../../../utils/Layer\";\nimport LegendRenderer from \"../../../../utils/LegendRenderer\";\nimport { mapFields } from \"vuex-map-fields\";\nexport default {\n  mixins: [Mapable],\n  name: \"map-legend\",\n  props: {\n    color: { type: String, default: \"#2BB381\" }\n  },\n  data: () => ({\n    layers: [],\n    panel: [],\n    isMapMounted: false,\n    isRendered: false\n  }),\n  methods: {\n    /**\n     * This function is executed, after the map is bound (see mixins/Mapable)\n     */\n    onMapBound() {\n      const me = this;\n      me.layers = me.map\n        .getLayers()\n        .getArray()\n        .filter(layer => layer.get(\"displayInLegend\") !== false);\n      this.isMapMounted = true;\n      EventBus.$on(\"openLegend\", () => this.panel.push(0));\n      EventBus.$on(\"closeLegend\", () => (this.panel = []));\n    },\n    getWMSLegendImageUrl(item, layerName) {\n      let layerUrl = item.getSource().getUrl();\n      if (layerUrl.startsWith(\"/\")) {\n        layerUrl = window.location.origin + layerUrl;\n      }\n      const style = item.getSource().getParams().STYLES;\n      const legedUrl = getWMSLegendURL(\n        layerUrl,\n        layerName,\n        undefined,\n        undefined,\n        undefined,\n        undefined,\n        item.getSource().serverType_,\n        120,\n        undefined,\n        undefined,\n        undefined,\n        this.$i18n.locale,\n        style\n      );\n      return legedUrl;\n    },\n    renderLegend(item, index) {\n      setTimeout(() => {\n        const styleObj = this.vectorTileStyles;\n        const name = item.get(\"name\");\n        let styleTranslation = this.vectorTileStyles[name].translation;\n        const currentLocale = this.$i18n.locale;\n        if (styleObj[name] && styleObj[name].format === \"geostyler\") {\n          let el = this.$refs[`legend-vector-${index}`];\n          el = el ? el : [];\n          if (el.length) {\n            if (Array.isArray(el) && el.length > 0) {\n              el = el[0];\n            }\n            // Remove existing svg elements on update (Workaround)\n            if (el && el.childNodes.length > 0) {\n              el.removeChild(el.childNodes[0]);\n            }\n            const style = styleObj[name].style;\n            const filteredStyle = this.filterStylesOnActiveMode(style);\n\n            const renderer = new LegendRenderer({\n              maxColumnWidth: 240,\n              overflow: \"auto\",\n              styles: [filteredStyle || style],\n              size: [230, 300],\n              translation: { styleTranslation, currentLocale }\n            });\n            renderer.render(el);\n          }\n        }\n      }, 100);\n    },\n    filterStylesOnActiveModeByLayerName(name) {\n      //get Filtered style on active mode based on layer name\n      const style = this.vectorTileStyles[name].style;\n      const filteredStyle = this.filterStylesOnActiveMode(style);\n      return filteredStyle || style;\n    },\n    filterStylesOnActiveMode(style) {\n      //get Filtered style on active mode based on style object\n      const styleRules = style.rules;\n      const filteredRules = [];\n      const activeMode = this.calculationMode.active;\n      let newStyle = { ...style };\n      if (Array.isArray(styleRules)) {\n        styleRules.forEach(rule => {\n          if (Array.isArray(rule.filter)) {\n            let showInLegend = true;\n            rule.filter.forEach(filter => {\n              /** FILTER CURRENT MODES. */\n              if (Array.isArray(filter) && filter.includes(\"modus\")) {\n                showInLegend = false;\n                const operator = filter[0];\n                const value = filter[2];\n                if (value === activeMode && operator === \"==\") {\n                  showInLegend = true;\n                } else if (value !== activeMode && operator === \"!=\") {\n                  showInLegend = true;\n                }\n              }\n            });\n            if (showInLegend) filteredRules.push(rule);\n            // Add all other rules in the legend\n          } else {\n            filteredRules.push(rule);\n          }\n        });\n        if (Array.isArray(filteredRules)) {\n          newStyle.rules = filteredRules;\n        }\n        return newStyle;\n      }\n    },\n    onExpansionPanelClick() {\n      if (!this.isRendered) {\n        this.$forceUpdate();\n        this.isRendered = true;\n      }\n    },\n    layerVisibility(item) {\n      if (\n        this.map.getView().getResolution() <= item.get(\"maxResolution\") &&\n        item.getVisible() === true &&\n        item.get(\"displayInLegend\") !== false &&\n        item.get(\"group\") !== \"basemap\" &&\n        this.isMapMounted === true &&\n        this.vectorTileStyles\n      ) {\n        return true;\n      }\n      return false;\n    }\n  },\n\n  computed: {\n    ...mapGetters(\"app\", {\n      calculationMode: \"calculationMode\"\n    }),\n    ...mapFields(\"map\", {\n      vectorTileStyles: \"vectorTileStyles\"\n    })\n  },\n  watch: {\n    \"calculationMode.active\": function() {\n      this.$forceUpdate();\n    }\n  }\n};\n</script>\n<style lang=\"css\" scoped>\n.v-expansion-panel-header {\n  min-height: 30px;\n  padding: 5px;\n}\n\n.v-expansion-panel-content >>> .v-expansion-panel-content__wrap {\n  padding: 2px 0px 0px 5px;\n}\n</style>\n"]}]}