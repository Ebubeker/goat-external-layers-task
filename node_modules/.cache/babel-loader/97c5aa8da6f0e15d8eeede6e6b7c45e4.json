{"remainingRequest":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/babel-loader/lib/index.js!/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/eslint-loader/index.js??ref--13-0!/home/ebubeker/Desktop/programming/work tasks/goat/app/client/src/components/other/dynamicForms/utils/schema.js","dependencies":[{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/src/components/other/dynamicForms/utils/schema.js","mtime":1657636289859},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/cache-loader/dist/cjs.js","mtime":1657636581841},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/babel-loader/lib/index.js","mtime":1657636581481},{"path":"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/eslint-loader/index.js","mtime":1657636581253}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.array.find\";\nimport _typeof from \"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.regexp.split\";\nimport _defineProperty from \"/home/ebubeker/Desktop/programming/work tasks/goat/app/client/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// Some util functions around schema manipulation to reduce size of the Property component\nimport i18n from \"../../../../plugins/i18n\";\nvar schemaUtils = {};\nexport default schemaUtils;\n\nvar objectToArray = function objectToArray(obj) {\n  return Object.keys(obj || {}).map(function (key) {\n    return _objectSpread({}, obj[key], {\n      key: key\n    });\n  });\n};\n\nvar countDecimals = function countDecimals(value) {\n  if (Math.floor(value) !== value) {\n    if (!value) return 0;\n    var splitted = value.toString().split(\".\");\n    if (splitted.length === 1) return 0;\n    return splitted[1].length || 0;\n  }\n\n  return 0;\n};\n\nvar getDeepKey = function getDeepKey(obj, key) {\n  var keys = key.split(\".\");\n\n  for (var i = 0; i < keys.length; i++) {\n    if ([null, undefined].includes(obj)) break;\n    obj = obj[keys[i]];\n  }\n\n  return obj;\n};\n\nschemaUtils.prepareFullSchema = function (schema, modelWrapper, modelKey) {\n  var fullSchema = JSON.parse(JSON.stringify(schema));\n  if (fullSchema.type !== \"object\") return fullSchema; // Properties as array, because order matters\n\n  fullSchema.properties = JSON.parse(JSON.stringify(objectToArray(fullSchema.properties)));\n  fullSchema.required = fullSchema.required || [];\n  fullSchema.dependencies = fullSchema.dependencies || {}; // Extend schema based on satisfied dependencies\n\n  if (fullSchema.dependencies) {\n    Object.keys(fullSchema.dependencies).forEach(function (depKey) {\n      var dep = fullSchema.dependencies[depKey]; // cases where dependency does not apply\n\n      if (!modelWrapper[modelKey]) return;\n      var val = getDeepKey(modelWrapper[modelKey], depKey);\n      if ([null, undefined, false].includes(val)) return;\n      if (Array.isArray(val) && val.length === 0) return;\n      if (_typeof(val) === \"object\" && Object.keys(val).length === 0) return; // dependency applies\n\n      fullSchema.required = fullSchema.required.concat(dep.required || []);\n      fullSchema.properties = fullSchema.properties.concat(objectToArray(dep.properties)); // fullSchema.extraProperties = []\n\n      if (dep.oneOf) fullSchema.oneOf = (fullSchema.oneOf || []).concat(dep.oneOf);\n      if (dep.allOf) fullSchema.allOf = (fullSchema.allOf || []).concat(dep.allOf);\n    });\n  }\n\n  return fullSchema;\n};\n\nvar layersConfig = {\n  buildings: {\n    fieldsConfig: {\n      building_levels: {\n        required: true,\n        linkedValidationWith: \"gross_floor_area\"\n      },\n      building_levels_residential: {\n        required: true,\n        linkedValidationWith: \"gross_floor_area\"\n      }\n    }\n  }\n};\n\nschemaUtils.getRules = function (fullSchema, required, options, data) {\n  var rules = [];\n  var layerConfig = layersConfig[fullSchema.layerName];\n\n  if (required || layerConfig && layerConfig.fieldsConfig && layerConfig.fieldsConfig[fullSchema.key] && layerConfig.fieldsConfig[fullSchema.key].required) {\n    rules.push(function (val) {\n      if (layerConfig && layerConfig.fieldsConfig && layerConfig.fieldsConfig[fullSchema.key] && layerConfig.fieldsConfig[fullSchema.key].linkedValidationWith) {\n        var key = layerConfig.fieldsConfig[fullSchema.key].linkedValidationWith;\n\n        if (data[key] || val) {\n          return true;\n        } else {\n          return options.requiredMessage;\n        }\n      } else {\n        return val !== undefined && val !== null && val !== \"\" || options.requiredMessage;\n      }\n    });\n  }\n\n  if ([\"building_levels\", \"building_levels_residential\"].includes(fullSchema.key)) {\n    rules.push(function (val) {\n      if (layerConfig && layerConfig.fieldsConfig && layerConfig.fieldsConfig[fullSchema.key] && layerConfig.fieldsConfig[fullSchema.key].linkedValidationWith) {\n        var key = layerConfig.fieldsConfig[fullSchema.key].linkedValidationWith;\n\n        if (data[key] || val) {\n          if (0 <= val < 0.01) {\n            return i18n.t(\"textFieldRules.greaterThanZero\");\n          } else {\n            return true;\n          }\n        } else {\n          return i18n.t(\"textFieldRules.greaterThanZero\");\n        }\n      }\n\n      return val >= 0.01 || i18n.t(\"textFieldRules.greaterThanZero\");\n    });\n    rules.push(function (val) {\n      return val <= 999.99 || i18n.t(\"textFieldRules.smallerThanThousand\");\n    });\n    rules.push(function (val) {\n      var decimalCount = countDecimals(val);\n      return decimalCount < 3 || i18n.t(\"textFieldRules.onlyTwoDecimalPlaces\");\n    });\n  }\n\n  if (fullSchema.type === \"array\" && fullSchema.minItems !== undefined) {\n    rules.push(function (val) {\n      return !val || val.length >= fullSchema.minItems || \"\";\n    });\n  }\n\n  if (fullSchema.type === \"array\" && fullSchema.maxItems !== undefined) {\n    rules.push(function (val) {\n      return !val || val.length <= fullSchema.maxItems || \"\";\n    });\n  }\n\n  if (fullSchema.type === \"string\" && fullSchema.minLength !== undefined) {\n    rules.push(function (val) {\n      return val === undefined || val === null || val.length >= fullSchema.minLength || \"\";\n    });\n  }\n\n  if (fullSchema.type === \"string\" && fullSchema.maxLength !== undefined) {\n    rules.push(function (val) {\n      return val === undefined || val === null || val.length <= fullSchema.maxLength || \"\";\n    });\n  }\n\n  if ([\"number\", \"integer\"].includes(fullSchema.type) && fullSchema.maximum !== undefined) {\n    rules.push(function (val) {\n      return val === undefined || val === null || val <= fullSchema.maximum || \"\";\n    });\n  }\n\n  if ([\"number\", \"integer\"].includes(fullSchema.type) && fullSchema.minimum !== undefined) {\n    rules.push(function (val) {\n      return val === undefined || val === null || val >= fullSchema.minimum || \"\";\n    });\n  }\n\n  if (fullSchema.enum) {\n    rules.push(function (val) {\n      return val === undefined || val === null || !!fullSchema.enum.find(function (item) {\n        return JSON.stringify(item) === JSON.stringify(val);\n      }) || \"\";\n    });\n  }\n\n  if (fullSchema.type === \"array\" && fullSchema.items.enum) {\n    rules.push(function (val) {\n      return val === undefined || val === null || !val.find(function (valItem) {\n        return !fullSchema.items.enum.find(function (item) {\n          return JSON.stringify(item) === JSON.stringify(valItem);\n        });\n      }) || \"\";\n    });\n  }\n\n  var oneOfSelect = schemaUtils.isOneOfSelect(fullSchema);\n\n  if (oneOfSelect && fullSchema.type !== \"array\") {\n    rules.push(function (val) {\n      return val === undefined || val === null || !!fullSchema.oneOf.find(function (item) {\n        return item.const === val;\n      }) || \"\";\n    });\n  }\n\n  if (oneOfSelect && fullSchema.type === \"array\") {\n    rules.push(function (val) {\n      return val === undefined || val === null || !val.find(function (valItem) {\n        return !fullSchema.items.oneOf.find(function (item) {\n          return item.const === valItem;\n        });\n      }) || \"\";\n    });\n  }\n\n  return rules;\n};\n\nschemaUtils.isOneOfSelect = function (fullSchema) {\n  return fullSchema.type === \"array\" && [\"string\", \"integer\", \"number\"].includes(fullSchema.items.type) && fullSchema.items.oneOf || [\"string\", \"integer\", \"number\"].includes(fullSchema.type) && fullSchema.oneOf;\n};",{"version":3,"sources":["/home/ebubeker/Desktop/programming/work tasks/goat/app/client/src/components/other/dynamicForms/utils/schema.js"],"names":["i18n","schemaUtils","objectToArray","obj","Object","keys","map","key","countDecimals","value","Math","floor","splitted","toString","split","length","getDeepKey","i","undefined","includes","prepareFullSchema","schema","modelWrapper","modelKey","fullSchema","JSON","parse","stringify","type","properties","required","dependencies","forEach","depKey","dep","val","Array","isArray","concat","oneOf","allOf","layersConfig","buildings","fieldsConfig","building_levels","linkedValidationWith","building_levels_residential","getRules","options","data","rules","layerConfig","layerName","push","requiredMessage","t","decimalCount","minItems","maxItems","minLength","maxLength","maximum","minimum","enum","find","item","items","valItem","oneOfSelect","isOneOfSelect","const"],"mappings":"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","sourcesContent":["// Some util functions around schema manipulation to reduce size of the Property component\nimport i18n from \"../../../../plugins/i18n\";\n\nconst schemaUtils = {};\n\nexport default schemaUtils;\n\nconst objectToArray = obj =>\n  Object.keys(obj || {}).map(key => ({ ...obj[key], key }));\n\nconst countDecimals = function(value) {\n  if (Math.floor(value) !== value) {\n    if (!value) return 0;\n    const splitted = value.toString().split(\".\");\n    if (splitted.length === 1) return 0;\n    return splitted[1].length || 0;\n  }\n  return 0;\n};\n\nconst getDeepKey = (obj, key) => {\n  const keys = key.split(\".\");\n  for (let i = 0; i < keys.length; i++) {\n    if ([null, undefined].includes(obj)) break;\n    obj = obj[keys[i]];\n  }\n  return obj;\n};\n\nschemaUtils.prepareFullSchema = (schema, modelWrapper, modelKey) => {\n  const fullSchema = JSON.parse(JSON.stringify(schema));\n\n  if (fullSchema.type !== \"object\") return fullSchema;\n\n  // Properties as array, because order matters\n  fullSchema.properties = JSON.parse(\n    JSON.stringify(objectToArray(fullSchema.properties))\n  );\n  fullSchema.required = fullSchema.required || [];\n  fullSchema.dependencies = fullSchema.dependencies || {};\n\n  // Extend schema based on satisfied dependencies\n  if (fullSchema.dependencies) {\n    Object.keys(fullSchema.dependencies).forEach(depKey => {\n      const dep = fullSchema.dependencies[depKey];\n      // cases where dependency does not apply\n      if (!modelWrapper[modelKey]) return;\n      const val = getDeepKey(modelWrapper[modelKey], depKey);\n      if ([null, undefined, false].includes(val)) return;\n      if (Array.isArray(val) && val.length === 0) return;\n      if (typeof val === \"object\" && Object.keys(val).length === 0) return;\n      // dependency applies\n      fullSchema.required = fullSchema.required.concat(dep.required || []);\n      fullSchema.properties = fullSchema.properties.concat(\n        objectToArray(dep.properties)\n      );\n      // fullSchema.extraProperties = []\n      if (dep.oneOf)\n        fullSchema.oneOf = (fullSchema.oneOf || []).concat(dep.oneOf);\n      if (dep.allOf)\n        fullSchema.allOf = (fullSchema.allOf || []).concat(dep.allOf);\n    });\n  }\n  return fullSchema;\n};\n\nconst layersConfig = {\n  buildings: {\n    fieldsConfig: {\n      building_levels: {\n        required: true,\n        linkedValidationWith: \"gross_floor_area\"\n      },\n      building_levels_residential: {\n        required: true,\n        linkedValidationWith: \"gross_floor_area\"\n      }\n    }\n  }\n};\n\nschemaUtils.getRules = (fullSchema, required, options, data) => {\n  const rules = [];\n  const layerConfig = layersConfig[fullSchema.layerName];\n  if (\n    required ||\n    (layerConfig &&\n      layerConfig.fieldsConfig &&\n      layerConfig.fieldsConfig[fullSchema.key] &&\n      layerConfig.fieldsConfig[fullSchema.key].required)\n  ) {\n    rules.push(val => {\n      if (\n        layerConfig &&\n        layerConfig.fieldsConfig &&\n        layerConfig.fieldsConfig[fullSchema.key] &&\n        layerConfig.fieldsConfig[fullSchema.key].linkedValidationWith\n      ) {\n        const key =\n          layerConfig.fieldsConfig[fullSchema.key].linkedValidationWith;\n        if (data[key] || val) {\n          return true;\n        } else {\n          return options.requiredMessage;\n        }\n      } else {\n        return (\n          (val !== undefined && val !== null && val !== \"\") ||\n          options.requiredMessage\n        );\n      }\n    });\n  }\n  if (\n    [\"building_levels\", \"building_levels_residential\"].includes(fullSchema.key)\n  ) {\n    rules.push(val => {\n      if (\n        layerConfig &&\n        layerConfig.fieldsConfig &&\n        layerConfig.fieldsConfig[fullSchema.key] &&\n        layerConfig.fieldsConfig[fullSchema.key].linkedValidationWith\n      ) {\n        const key =\n          layerConfig.fieldsConfig[fullSchema.key].linkedValidationWith;\n        if (data[key] || val) {\n          if (0 <= val < 0.01) {\n            return i18n.t(\"textFieldRules.greaterThanZero\");\n          } else {\n            return true;\n          }\n        } else {\n          return i18n.t(\"textFieldRules.greaterThanZero\");\n        }\n      }\n      return val >= 0.01 || i18n.t(\"textFieldRules.greaterThanZero\");\n    });\n    rules.push(\n      val => val <= 999.99 || i18n.t(\"textFieldRules.smallerThanThousand\")\n    );\n    rules.push(val => {\n      const decimalCount = countDecimals(val);\n      return decimalCount < 3 || i18n.t(\"textFieldRules.onlyTwoDecimalPlaces\");\n    });\n  }\n  if (fullSchema.type === \"array\" && fullSchema.minItems !== undefined) {\n    rules.push(val => !val || val.length >= fullSchema.minItems || \"\");\n  }\n  if (fullSchema.type === \"array\" && fullSchema.maxItems !== undefined) {\n    rules.push(val => !val || val.length <= fullSchema.maxItems || \"\");\n  }\n  if (fullSchema.type === \"string\" && fullSchema.minLength !== undefined) {\n    rules.push(\n      val =>\n        val === undefined ||\n        val === null ||\n        val.length >= fullSchema.minLength ||\n        \"\"\n    );\n  }\n  if (fullSchema.type === \"string\" && fullSchema.maxLength !== undefined) {\n    rules.push(\n      val =>\n        val === undefined ||\n        val === null ||\n        val.length <= fullSchema.maxLength ||\n        \"\"\n    );\n  }\n  if (\n    [\"number\", \"integer\"].includes(fullSchema.type) &&\n    fullSchema.maximum !== undefined\n  ) {\n    rules.push(\n      val =>\n        val === undefined || val === null || val <= fullSchema.maximum || \"\"\n    );\n  }\n  if (\n    [\"number\", \"integer\"].includes(fullSchema.type) &&\n    fullSchema.minimum !== undefined\n  ) {\n    rules.push(\n      val =>\n        val === undefined || val === null || val >= fullSchema.minimum || \"\"\n    );\n  }\n  if (fullSchema.enum) {\n    rules.push(\n      val =>\n        val === undefined ||\n        val === null ||\n        !!fullSchema.enum.find(\n          item => JSON.stringify(item) === JSON.stringify(val)\n        ) ||\n        \"\"\n    );\n  }\n  if (fullSchema.type === \"array\" && fullSchema.items.enum) {\n    rules.push(\n      val =>\n        val === undefined ||\n        val === null ||\n        !val.find(\n          valItem =>\n            !fullSchema.items.enum.find(\n              item => JSON.stringify(item) === JSON.stringify(valItem)\n            )\n        ) ||\n        \"\"\n    );\n  }\n  const oneOfSelect = schemaUtils.isOneOfSelect(fullSchema);\n  if (oneOfSelect && fullSchema.type !== \"array\") {\n    rules.push(\n      val =>\n        val === undefined ||\n        val === null ||\n        !!fullSchema.oneOf.find(item => item.const === val) ||\n        \"\"\n    );\n  }\n  if (oneOfSelect && fullSchema.type === \"array\") {\n    rules.push(\n      val =>\n        val === undefined ||\n        val === null ||\n        !val.find(\n          valItem =>\n            !fullSchema.items.oneOf.find(item => item.const === valItem)\n        ) ||\n        \"\"\n    );\n  }\n  return rules;\n};\n\nschemaUtils.isOneOfSelect = fullSchema => {\n  return (\n    (fullSchema.type === \"array\" &&\n      [\"string\", \"integer\", \"number\"].includes(fullSchema.items.type) &&\n      fullSchema.items.oneOf) ||\n    ([\"string\", \"integer\", \"number\"].includes(fullSchema.type) &&\n      fullSchema.oneOf)\n  );\n};\n"]}]}